{% extends 'app1/base.html' %}
{% block body %}
{% load static %}
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>


<style>
    input {
      background-color: #2f516f;
      border: 0;
      border-radius: 5px;
      color: white;
    }
    #customer{
          
          color: white;
      }
  
      .selectize-input {
          height: 5vh;
          border-color:white;
          border-radius: 5px;
          background-color: #2f516f;
      }
  
      .option:hover {
          background-color: #3B71CA;
          color: white;
      }   
  </style>
<form action="{% url 'updateestimate2' estimate.estimateid %}" method="post" class="needs-validation" enctype="multipart/form-data" novalidate>
  {% csrf_token %}
  <div class="page-content">
    <!--breadcrumb-->
    <div class="card radius-15">
      <div class="card-body">
        <div class="card-title">
          <center><h2 class="mb-0" id="estno">EDIT ESTIMATE NO.{{ estimate.estimateno }}</h2></center>
      </div>
        <hr />
      </div>
    </div>
    <div class="card radius-15">
      <div class="card-body">
        <div id="invoice">
         <div class="row mt-3">
            <div class="col-md-4">
                <label class="col-form-label">Reference Number</label>
                <input type="text" class="form-control" name="Ref_No" value="{{ estimate.reference_number }}"><br> 
            </div>
            <div class="col-md-4">
                <label class="col-form-label">EStimate No.</label><span class="text-danger mt-1 ml-3 " id="dangerdiv" style="display: none;"><span class="text-white"> (</span>This Id Should be Continous<span class="text-white">)</span></span>
                  
                    <input type="text" class="form-control" name="ord_no" value="{{estimate.estimateno}}"  id="ord_no" style="background-color: #43596c;"><br>
               
            </div>
         </div>
          <div class="row mt-3">
            
            <div class="col-md-4">
              <label class="col-form-label">Customer</label>
              <div class="d-flex">
                  <select name="customer_name" id="customer" class="form-control" style="width: 95%;">
                      <option value="{{ estimate.customer_name }}" selected>{{cust.title}} {{ cust.firstname }} {{ cust.lastname }}
                      {% for cust in customers %}
                          {% if cust.cid_id == cmp1.cid %}
                              <option text=""
                                      value="{{cust.customerid}} {{ cust.firstname }} {{ cust.lastname }}">{{cust.title}} {{ cust.firstname }} {{ cust.lastname }}</option>
                          {% endif %}
                      {% endfor %}
                  </select>
                  <a data-toggle="modal" href="#customercreation">
                      <button type="button" class="btn btn-outline-secondary ml-1">+</button>
                  </a>
              </div>
              <label class="col-form-label">GST Type</label>
              <input type="text" class="form-control" id="gsttype" name="gsttype" value="{{cust.gsttype}}" style="background-color: #43596c;" readonly>
            </div>
          <div class="col-md-4">
            <label class="col-form-label">Email</label>
            <input type="text" class="form-control" id="cust_email" value="{{ estimate.email }}" name="email"
                   placeholder="Email"><br>
                
                   
                   
                   {% if cust.gstin %}
                    <div id="gstnodiv" >
                        <label class="col-form-label">GSTIN</label>
                        <input type="text" class="form-control" id="gstno" name="gstno" style="background-color: #43596c;" value="{{cust.gstin}}" readonly>
                    </div>
                    {% else %}
                        <div id="gstnodiv" style="display: none;">
                        <label class="col-form-label">GSTIN</label>
                        <input type="text" class="form-control" id="gstno" name="gstno" style="background-color: #43596c;" readonly>
                    </div>
                    {% endif %}
        </div>
            <div class="col-md-4">
              <label class="col-form-label">Billing Address</label>
              <label for="billingaddress"></label>
              <textarea class="form-control" rows="7" id="bname" value="{{estimate.billingaddress}}"
                        name="billingaddress">{{ estimate.billingaddress }}</textarea>
          </div>
        </div>
        <!-- <div class="row mt-3">
            
        </div> -->
        <div class="row mt-3">
            
            
            <div class="col-md-3">
                <label class="col-form-label">Estimate Date</label>
                <input type="date" class="form-control" value="{{ estimate.estimatedate | date:'Y-m-d'  }}"
                       name="estimatedate" id="estimatedate"><br>
            </div>
            <div class="col-md-3">
                <label class="col-form-label">Expiration Date</label>
                <input type="date" class="form-control" value="{{ estimate.expirationdate | date:'Y-m-d'  }}"
                       name="expirationdate" id="expirationdate"><br>
            </div>
            <div class="col-md-3">
                <label class="col-form-label">Payment Term</label>
                <div class="d-flex">
                    <select type="text" class="form-control" id="pay_term" name="pay_term" style="background-color: #43596c; color: white;" >
                      <option value="{{estimate.term_days}}" selected hidden>NET {{estimate.term_days}}</option>
                      <option value="0">Due On Receipt</option>
                      <option value="30">NET 30</option>
                      <option value="60">NET 60</option>
                      {% for term in terms %}
                          <option value="{{term.days}}">{{term.term}}</option>
                      {% endfor %}
                    </select>
                    <a class="btn btn-outline-secondary ml-1" role="button" data-target="#newpayment" data-toggle="modal" id="termadd">+</a>
                </div>
              </div>
            <div class="col-md-3 ">
              <label class="col-form-label">Place of supply</label>
              <select type="text" class="form-control" id="plosu" name="placosupply" style="background-color: #2f516f; color: white;" onchange="state(this)">
                <option value="{{ estimate.placeofsupply }}" selected> {{ estimate.placeofsupply }}</option>
                <option value="{{ cust.shipstate }}" > {{cust.shipstate}}</option>
                <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islads</option>
                <option value="Andhra Predhesh">Andhra Predhesh</option>
                <option value="Arunachal Predesh">Arunachal Predesh</option>
                <option value="Assam">Assam</option>
                <option value="Bihar">Bihar</option>
                <option value="Chandigarh">Chandigarh</option>
                <option value="Chhattisgarh">Chhattisgarh</option>
                <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                <option value="Damn anad Diu">Damn anad Diu</option>
                <option value="Delhi">Delhi</option>
                <option value="Goa">Goa</option>
                <option value="Gujarat">Gujarat</option>
                <option value="Haryana">Haryana</option>
                <option value="Himachal Predesh">Himachal Predesh</option>
                <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                <option value="Jharkhand">Jharkhand</option>
                <option value="Karnataka">Karnataka</option>
                <option value="Kerala">Kerala</option>
                <option value="Ladakh">Ladakh</option>
                <option value="Lakshadweep">Lakshadweep</option>
                <option value="Madhya Predesh">Madhya Predesh</option>
                <option value="Maharashtra">Maharashtra</option>
                <option value="Manipur">Manipur</option>
                <option value="Meghalaya">Meghalaya</option>
                <option value="Mizoram">Mizoram</option>
                <option value="Nagaland">Nagaland</option>
                <option value="Odisha">Odisha</option>
                <option value="Puducherry">Puducherry</option>
                <option value="Punjab">Punjab</option>
                <option value="Rajasthan">Rajasthan</option>
                <option value="Sikkim">Sikkim</option>
                <option value="Tamil Nadu">Tamil Nadu</option>
                <option value="Telangana">Telangana</option>
                <option value="Tripura">Tripura</option>
                <option value="Uttar Predesh">Uttar Predesh</option>
                <option value="Uttarakhand">Uttarakhand</option>
                <option value="West Bengal">West Bengal</option>
                <option value="Other Territory">Other Territory</option>
              </select>
            </div>
            
        </div>
          <!-- <div class="row">
            
            <div class="col-md-3 mt-3"></div>
            <div class="col-md-3 mt-3"></div>
            <div class="col-md-3 mt-3"></div>
          </div> -->
          <div class="row clearfix">
            <div class="col-md-12 table-responsive-md mt-3">
              <table class="table table-bordered table-hover mt-3" id="tab_logic">
                <thead>
                  <tr>
                    <th class="text-center">#</th>
                    <th class="text-center" >PRODUCT / SERVICE</th>
                    <th class="text-center">HSN</th>
                    <th class="text-center">QTY</th>
                    <th class="text-center">PRICE</th>
                    <th class="text-center">TAX (%)</th>
                    <th class="text-center">DISCOUNT</th>
                    <th class="text-center">TOTAL</th>
                    
                  </tr>
                </thead>
                <tbody id="items-table-body">

                  {% for j in estimateitem %}
                  <tr id='addr0{{ forloop.counter }}'>
                    <td class="nnum">{{ forloop.counter }}
                        <input type="text"  name='id[]' value="{{ j.id }}" hidden>

                    </td>
                    <td style="width: 20%;">
                      <div class="d-flex">
                      <select name='product[]' id="product{{ forloop.counter }}" class="form-control product" style="background-color: #2f516f; color: white;">

                        <option value="{{ j.item }}" selected>{{ j.item }}</option>
                        {% for i in item %}
                        {% if i.cid_id == cmp1.cid %}
                            <option 
                                    value="{{ i.name  }}">{{ i.name  }} </option>
                        {% endif %}
                    {% endfor %}
                      </select>
                    <a href="#">
                      <button type="button" class="btn btn-outline-secondary ml-1" 
                      data-target="#newitem" data-toggle="modal">+</button>
                  </a>
                  </div>
                    </td>
                    <td><input type="text" name='hsn[]'  value="{{ j.hsn }}" id="hsn{{ forloop.counter }}" placeholder='Enter HSN Code' class="form-control" style="background-color: #2f516f; color: white;" /></td>
                    <td><input type="number" name='qty[]' value="{{ j.quantity }}" placeholder='Enter Qty' style="margin-top: 21px;" id="qty{{ forloop.counter }}" value=0 class="form-control qty" step=0 min=0 style="background-color: #2f516f; color: white;" />
                      <div class=""><span></span> <label id="qtyspan{{forloop.counter}}" class='' hidden></label></div>
                    </td>
                    <td><input type="number" name='price[]' value="{{ j.rate}}" id="unit{{ forloop.counter }}" placeholder='Enter Unit Price' class="form-control price" step="0.00" min="0" style="background-color: #2f516f; color: white;" /></td>
                    
                     <td style="width: 13%;">
                   
                    <input hidden value="{{cmp1.state}}" id="cmpstate">
                      <input type="text"  id="select_tax" placeholder="Tax Rate" class="form-control seltax d-none" style="background-color: #43596c;">
                      <select name='tax1[]' id="tax1{{ forloop.counter }}" class="form-control tax intra_tax d-none" style="background-color: #43596c;">
                        <option selected value="{{j.tax}}" hidden>{{j.tax}}% GST </option>
                        <option value=0>0% GST</option>
                        <option value=3>3% GST </option>
                        <option value=5>5% GST </option>
                        <option value=12>12% GST </option>
                        <option value=18>18% GST </option>
                        <option value=28>28% GST</option>
                        <option value=0>Out of Scope(0%)</option>
                      </select>
                      <select name='tax2[]' id="tax2{{ forloop.counter }}" class="form-control tax inter_tax d-none">
                        <option selected value="{{j.tax}}" hidden>{{j.tax}}% IGST</option>
                        <option value=28 >28% IGST</option>
                        <option value=18 >18% IGST(18%)</option>
                        <option value=12  >12% IGST(12%)</option>
                            <option value=5  >5% IGST(05%)</option>
                        <option value=3  >03.0% IGST(03%)</option>
                            <option value=0  >0.0% IGST(0%)</option>
                      </select>
                                       
                    </td>
                    <td>
                      <input type="number" name='discount[]' placeholder='Enter Discount' id="disc{{forloop.counter}}" value="{{j.discount|default:0}}" class="form-control disc" step=0 min=0>
                   </td>
                    <td><input type="number" name='total[]' value="{{ j.total }}" id="total1{{ forloop.counter }}" placeholder=0 class="form-control total" value=0 step="any" readonly style="background-color: #2f516f; color: white;" /></td>
                    <td style="display: none;"><input type="number" step="any" name='taxamount1' id="taxamount1{{ forloop.counter }}" class="form-control taxamount" />
                    </td>
                    <td>
                        <button type="button" id="{{forloop.counter}}" class="btn  font-weight-bold clone_row fa fa-clone px-2 my-1 py-1" title="Clone Row" style="background-color:#43596c;"></button><br>
                        <button type="button" id="{{forloop.counter}}" class="btn btn-danger remove_row px-2 py-1 mx-1 fa fa-close" title="Remove Row"> </button>
                  </td>
                  </tr>
                  {% endfor %}

              </tbody>
              <tr>
                <td style="border: none;"><a class="btn btn-outline-secondary ml-1" role="button" id="add">+</a></td>
            </tr>
              </table>

            </div>
          </div>
          <div class="row clearfix" style="margin-top:20px">
            <div class="col-md-6">

                <textarea class="form-control"  id="" name="Note" placeholder="Note" style="height: 190px;" value="{{estimate.note}}">{{ estimate.note}}</textarea>

                <input type="file" name="file"  style="margin-top: 10px; width: 70%;">
            </div>

            <div class="col-md-1"></div>
              <div class="col-md-5 table-responsive-md mt-3" id="tab_logic_total" style="background-color:rgba(0,0,0,.4); border: 1px solid rgba(128, 128, 128, 0.6);">
                  <div class="p-3">
                      <div class="row container-fluid p-2 m-0">
                          <div class="col-sm-4 mt-2"><label class="text-center">Sub Total</label></div>
                          <div class="col-sm-1 mt-2">:</div>
                          <div class="col-sm-7 mt-2"><input type="number" step="any" name='subtotal' placeholder=0 value="{{estimate.subtotal}}"
                              class="form-control" id="sub_total">
                          </div>
                          <div class="col-sm-4 m-0 p-0"></div>
                      </div>
                      <div class="row container-fluid p-2 m-0" id="igst1">
                          <div class="col-sm-4 mt-2"><label for="a" class="text-center">IGST</label></div>
                          <div class="col-sm-1 mt-2">:</div>
                          <div class="col-sm-7 mt-2"><input type="number" name='igst' step="any" id="igst" placeholder=0 value="{{estimate.IGST}}"
                              class="form-control"/>
                          </div>
                          <div class="col-sm-4 m-0 p-0"></div>
                      </div>
                      <div class="row container-fluid p-2 m-0" style="display: none;" id="cgst1">
                          <div class="col-sm-4 mt-2"><label for="a" class="text-center">CGST</label></div>
                          <div class="col-sm-1 mt-2">:</div>
                          <div class="col-sm-7 mt-2"><input type="number" name='cgst' step="any" id="cgst" placeholder=0  value="{{estimate.CGST}}"
                              class="form-control"/>
                          </div>
                          <div class="col-sm-4 m-0 p-0"></div>
                      </div>
                      <div class="row container-fluid p-2 m-0" style="display: none;" id="sgst1">
                          <div class="col-sm-4 mt-2"><label for="a" class="text-center">SGST</label></div>
                          <div class="col-sm-1 mt-2">:</div>
                          <div class="col-sm-7 mt-2"><input type="number" name='sgst' step="any" id="sgst" placeholder=0 value="{{estimate.SGST}}" 
                              class="form-control"/>
                          </div>
                          <div class="col-sm-4 m-0 p-0"></div>
                      </div>
                      <div class="row container-fluid p-2 m-0">
                          <div class="col-sm-4 mt-2"><label for="a" class="text-center">Tax Amount</label></div>
                          <div class="col-sm-1 mt-2">:</div>
                          <div class="col-sm-7 mt-2"><input type="number" step="any" name='taxamount' value="{{estimate.taxamount}}" id="tax_amount" placeholder='0.00' 
                              class="form-control"/>
                          </div>
                          <div class="col-sm-4 m-0 p-0"></div>

                      </div>
                      
                      <div class="row container-fluid p-2 m-0">
                          <div class="col-sm-4 mt-2"><label for="a" class="text-center">Shipping Charge</label></div>
                          <div class="col-sm-1 mt-2">:</div>
                          <div class="col-sm-7 mt-2"><input type="number" step="any" value="{{estimate.shipping_charge}}" name='ship' id="ship" placeholder='0.00'  value=0
                              class="form-control"/>
                          </div>
                          <div class="col-sm-4 m-0 p-0"></div>
                      </div>
                      <div class="row container-fluid p-2 m-0">
                          <div class="col-sm-4 mt-2"><label for="a" class="text-center">Adjustment</label></div>
                          <div class="col-sm-1 mt-2">:</div>
                          <div class="col-sm-7 mt-2"><input type="number" step="any" name='adj' id="adj" value="{{estimate.adjust}}" placeholder='0.00' 
                              class="form-control"/>
                          </div>
                          <div class="col-sm-4 m-0 p-0"></div>
                      </div>
                      <div class="row container-fluid p-2 m-0">
                          <div class="col-sm-4 mt-2"><label for="a" class="text-center">Grand Total</label></div>
                          <div class="col-sm-1 mt-2">:</div>
                          <div class="col-sm-7 mt-2"><input type="number" name='grandtotal' value="{{estimate.estimatetotal}}" id="grandtotal" placeholder='0.00' readonly
                              class="form-control"/>
                          </div>
                          <div class="col-sm-4 m-0 p-0"></div>
                      </div>
                  </div>
                  
              </div>


          </div>
          <div class="row">
            <div class="col-md-10 mt-3"></div>
            <div class="col-md-2 mt-3">
              <button type="submit" class="btn btn-outline-info rounded-pill w-100 text-grey pull-left">
                Save 
              </button>
            </div>
          </div>
          <div class="notices mt-3">
            <div class="text-muted">NOTICE:</div>
            <div class="text-muted">
              Fin sYs Terms and Conditions Apply
            </div>
          </div>
          <footer class="text-muted">Invoice was created on a computer and is valid without the
            signature and seal.
          </footer>
        </div>
      </div>
    </div>
  </div>
</form>

<!-- 
    modal -->

    <div class="modal fade" id="newpayment">
        <div class="modal-dialog">
            <div class="modal-content" style="background-color: #213b52;">
                <div class="modal-header">
                    <h3 class="m-3">New Payment Term</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="card p-3 m-3">
                        <form action="" autocomplete="off" id="modalForm" onsubmit="return false">
                            <div id="terms-container">
                                <div class="form-row" id="termdrop">
                                    <div class="col-6" >
                                        <input type="text" value="Due On Receipt" class="form-control" style="background-color: #191c24; color: white;" readonly>
                                      </div>
    
                                      <div class="col-6">
                                        <input type="text" value="0" class="form-control" style="background-color: #191c24; color: white;" readonly>
                                      </div>       
    
                                      <div class="col-6" >
                                        <input type="text" value="NET 30" class="form-control" style="background-color: #191c24; color: white;" readonly>
                                      </div>
                                      <div class="col-6">
                                        <input type="text" value="30" class="form-control" style="background-color: #191c24; color: white;" readonly>
                                      </div>                                
                                      
                                      <div class="col-6" >
                                        <input type="text" value="NET 60" class="form-control" style="background-color: #191c24; color: white;" readonly>
                                      </div>
                                      <div class="col-6">
                                        <input type="text" value="60" class="form-control" style="background-color: #191c24; color: white;" readonly>
                                      </div>
                                  {% for term in terms %}
                                    <div class="col-6" >
                                      <input type="text" value="{{term.term}}" class="form-control" placeholder="Terms" style="background-color: #191c24; color: white;" readonly>
                                    </div>
                                    <div class="col-6">
                                      <input type="text" value="{{term.days}}" class="form-control" placeholder="No of Days" style="background-color: #191c24; color: white;" readonly>
                                    </div>
                                  {% endfor %}
                                  <div class="col-6">
                                    <input type="text" name="terms" class="form-control" placeholder="Terms" style="background-color: #191c24;">
                                  </div>
                                  <div class="col-6">
                                    <input type="text" name="days" class="form-control" placeholder="No of Days" style="background-color: #191c24;">
                                  </div>
                                </div>
                              </div>
                              <div class="form-row mt-3">
                                <div class="col-12">
                                  <button type="button" class="btn btn-outline-secondary add-term-row text-white" >Add New</button>
                                  <input type="submit" class="btn btn-success" value="Submit" id="payment">
                                </div>
                              </div>
                    </form>
                  </div>
              </div>
          </div>
      </div> 
      </div>
    

    <div class="modal fade" id="customercreation">
        <div class="modal-dialog modal-xl">
            <div class="modal-content" style="background-color: #213b52;">
                <div class="modal-header">
                    <h3 class="m-3">ADD CUSTOMER</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            <div class="modal-body">
  
                <form action="" method="POST" id="modalCustomer"> 
  
                    <div class="row">
                        <div class="col-md-4 mt-3">
                            <label for="validationCustom01">Title</label>
                            <select name="title" id="title" class="form-control" >
                                <option value="Mr">Mr</option>
                                <option value="Mrs">Mrs</option>
                                <option value="Miss">Miss</option>
                                <option value="Ms">Ms</option>
                            </select>
                            <div class="valid-feedback">Looks good!</div>
                        </div>
                        <div class="col-md-4 mt-3">
                            <label for="validationCustom02">First name</label>
                            <input type="text" class="form-control" id="firstname" name="firstname" 
                                   required style="background-color: 43596c;color: white;">
                            <div class="valid-feedback">Looks good!</div>
                        </div>
                        <div class="col-md-4 mt-3">
                            <label for="validationCustom02">Last name</label>
                            <input type="text" class="form-control" id="lastname" name="lastname"
                                   required style="background-color: 43596c;color: white;">
                            <div class="valid-feedback">Looks good!</div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mt-3">
                            <label for="validationCustom03">Company</label>
                            <input type="text" class="form-control" id="company" name="company"
                                   required style="background-color: 43596c;color: white;">
                            <div class="valid-feedback">Looks good!</div>
                        </div>
                        <div class="col-md-4 mt-3">
                            <label for="validationCustom03">Location</label>
                            <input type="text" class="form-control" id="location" name="location"
                                   required style="background-color: 43596c;color: white;">
                            <div class="valid-feedback">Looks good!</div>
                        </div>
                        <div class="col-md-4 mt-3"></div>
                    </div>
                    <div class="row">
                      <div class="col-md-4 mt-3">
                          <label for="gsttype">GST type</label>
                          <select class="custom-select" id="gsttype" name="gsttype"
                                  onchange="hidinput('hello1',this)   "
                                  
                                  required
                                  style="background-color: 43596c; color: white;">
                                  <option selected disabled value="" hidden>Select GST Type</option>
                                  <option value="Registered Business - Regular">Registered Business - Regular <span><i>(Business that is registered under gst)</i></span></option>
                                  <option value="Registered Business - Composition">Registered Business - Composition (Business that is registered under composition scheme in gst)</option>
                                  <option value="unregistered Business">Unregistered Business (Business that has not been registered under gst)</option>
                                  <option value="Overseas">Overseas (Import/Export of supply outside india)</option>
                                  <option value="Consumer">Consumer</option>
                                  <option value="Special Economic Zone (SEZ)">Special Economic Zone (SEZ) (Business that is located in a special economic zone of india or a SEZ developer)</option>
                                  <option value="Demed Exports">Demed Exports (Supply of woods to an exports oriented unit or againsed advanced authorization or export promotion capital woods)</option>
                                  <option value="Tax Deductor">Tax Deductor (State of central gov,government agencies or local authority)</option>
                                  <option value="SEZ Developer">SEZ Developer (A person or organization who owns atleast 26% eqaulity in creating business units in special economic zone)</option>
  
                          </select>
                          <div class="invalid-feedback">Please select a valid registration type.</div>
                      </div>
  
                      <div class="col-md-4 mt-3 gstrow" id="hello1" style="display: none;">
                          <div >
                              <label for="gstin">GSTIN</label>
                              <input type="text" class="form-control" onchange="showMessage(this)"
                                     id="gstin" name="gstin"
                                     style="background-color: 43596c;color: white;"
                                     value=""
                                     placeholder="29APPCK7465F1Z1">
                                     <a data-toggle="modal" href="#exampleModal"
                              style="color:#3dd5f3">Get Taxpayer Details</a>
                              <div class="text-danger m-2" id="warngst"></div>
                          </div>
                      </div>
  
                        
                        <!-- <div class="col-md-4 mt-3" id="hai">
                            <div >
                                <label for="validationCustom05">BUSINESS LEGAL NAME</label>
                                <input type="text" class="form-control" 
                                       
                                       style="background-color: 43596c;color: white;"
                                       >
                                <div class="text-danger m-2" id="warngst"></div>
                            </div>
                        </div>
  
                        <div class="col-md-4 mt-3" id="hai1">
                            <div >
                                <label for="validationCustom05">BUSINESS TRADE NAME</label>
                                <input type="text" class="form-control" 
                                       
                                       style="background-color: 43596c;color: white;"
                                       >
                                <div class="text-danger m-2" id="warngst"></div>
                            </div>
                        </div> -->
                        
                    
  
                        <div class="col-md-4 mt-3">
                            <label for="validationCustom03">PAN NO</label>
                            <input type="text" class="form-control" id="panno" name="panno"
                                   required style="background-color: 43596c;color: white;"
                                   onchange="checkpan(this)" placeholder="APPCK7465F">
                            <div class="text-danger m-2" id="warnpan"></div>
                        </div>
  
                        <!-- <div class="col-md-4 mt-3" id="hai1">
                            <div >
                                <label for="validationCustom05">PLACE OF SUPPLY</label>
                                <input type="text" class="form-control" 
                                       
                                       style="background-color: 43596c;color: white;"
                                       >
                                <div class="text-danger m-2" id="warngst"></div>
                            </div>
                        </div>
  
                        <div class="col-md-4 mt-3" id="hai1">
                            <div >
                                <label for="validationCustom05">TAX PERFERENCE</label>
                                <input type="text" class="form-control" 
                                       
                                       style="background-color: 43596c;color: white;">
                                <div class="text-danger m-2" id="warngst"></div>
                            </div>
                        </div>
                        <div class="col-md-4 mt-3" >
                            <div>
                                <label for="validationCustom05">TAX RETURNS</label><br>
                                <input type="radio" name="Returns" 
                                       
                                       style="background-color: 43596c;color: white;"> Taxable
                                       <input type="radio" name="Returns"  
                                       style="background-color: 43596c;color: white;"> Non Taxable
                                <div class="text-danger m-2" id="warngst"></div>
                            </div>
                        </div> -->
  
                        <div class="col-md-4 mt-3" >
                          <label for="openbalance">Opening Balance</label>
                          <div class="d-flex">
                              <select name="bal" id="bal" class="form-select text-white pl-1" style="background-color: #243e54; width: 25%; border-radius: 5px;">
                                  <option value="credit">Credit</option>
                                  <option value="debit">Debit</option>
                              </select>
                              <input type="number" class="form-control" id="openbalance"  name="openbalance"
                                  style="background-color: #43596c;color: white;">
                              <div class="text-danger m-2" ></div>
                          </div>
                      </div>
  
                      <div class="col-md-4 mt-3" >
                          <div>
                              <label for="openbalance">Credit Limit</label>
                              <input type="number" class="form-control" id="crd_lmt"  name="crd_lmt"
                                  style="background-color: #43596c;color: white;">
                              <div class="text-danger m-2" ></div>
                          </div>
                      </div>
                    </div>
  
                    
  
                    
  
                    <div class="row">
                        <div class="col-md-4 mt-3">
                            <label for="validationCustom03">Email</label>
                            <input type="email" class="form-control" id="email" name="email"
                                   required style="background-color: 43596c;color: white;"
                                   placeholder="finsys@mail.com">
                            <div class="invalid-feedback">Please provide a valid Email</div>
                        </div>
                        <div class="col-md-4 mt-3">
                            <label for="validationCustom03">Website</label>
                            <input type="text" class="form-control" id="website"
                                   placeholder="www.finsys.com" onchange="checkweb(this)" name="website"
                                   style="background-color: 43596c;color: white;">
                            <div id="warnweb" class="text-danger"></div>
                        </div>
                        <div class="col-md-4 mt-3">
                            <label for="validationCustom01">Mobile</label>
                            <input type="text" class="form-control" id="mobile"
                                   onchange="checkphone(this)" name="mobile"
                                   required style="background-color: 43596c;color: white;">
                            <div class="text-danger m-2" id="warnphone"></div>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-6 mt-5">
                            <div class="row">
                                <div class="col-md-12 card-title">
                                    <h5 class="mb-0">Billing Address</h5>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12 mt-3">
                                    <div class="form-row">
                                        <label for="street">Street</label>
                                        <textarea class="form-control street" id="street" name="street"
                                                  required
                                                  style="background-color: 43596c;color: white;"></textarea>
                                        <div class="invalid-feedback">Please provide a valid Street</div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mt-3">
                                    <div class="form-row">
                                        <label for="city">City</label>
                                        <input type="text" class="form-control" id="city"
                                               name="city"
                                               required
                                               style="background-color: 43596c;color: white;" placeholder="City">
                                        <div class="invalid-feedback">Please provide a valid City</div>
                                    </div>
                                </div>
                                <div class="col-md-6 mt-3">
                                    <div class="form-row">
                                        <label for="state">State</label>
                                        <select type="text" class="form-control" id="state" name="state"
                                                style="background-color: 43596c; color: white;">
                                            <option value="" disabled selected hidden>Choose</option>
                                            <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islads
                                            </option>
                                            <option value="Andhra Predhesh">Andhra Predhesh</option>
                                            <option value="Arunachal Predesh">Arunachal Predesh</option>
                                            <option value="Assam">Assam</option>
                                            <option value="Bihar">Bihar</option>
                                            <option value="Chandigarh">Chandigarh</option>
                                            <option value="Chhattisgarh">Chhattisgarh</option>
                                            <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                            <option value="Damn anad Diu">Damn anad Diu</option>
                                            <option value="Delhi">Delhi</option>
                                            <option value="Goa">Goa</option>
                                            <option value="Gujarat">Gujarat</option>
                                            <option value="Haryana">Haryana</option>
                                            <option value="Himachal Predesh">Himachal Predesh</option>
                                            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                            <option value="Jharkhand">Jharkhand</option>
                                            <option value="Karnataka">Karnataka</option>
                                            <option value="Kerala">Kerala</option>
                                            <option value="Ladakh">Ladakh</option>
                                            <option value="Lakshadweep">Lakshadweep</option>
                                            <option value="Madhya Predesh">Madhya Predesh</option>
                                            <option value="Maharashtra">Maharashtra</option>
                                            <option value="Manipur">Manipur</option>
                                            <option value="Meghalaya">Meghalaya</option>
                                            <option value="Mizoram">Mizoram</option>
                                            <option value="Nagaland">Nagaland</option>
                                            <option value="Odisha">Odisha</option>
                                            <option value="Puducherry">Puducherry</option>
                                            <option value="Punjab">Punjab</option>
                                            <option value="Rajasthan">Rajasthan</option>
                                            <option value="Sikkim">Sikkim</option>
                                            <option value="Tamil Nadu">Tamil Nadu</option>
                                            <option value="Telangana">Telangana</option>
                                            <option value="Tripura">Tripura</option>
                                            <option value="Uttar Predesh">Uttar Predesh</option>
                                            <option value="Uttarakhand">Uttarakhand</option>
                                            <option value="West Bengal">West Bengal</option>
                                            <option value="Other Territory">Other Territory</option>
                                        </select>
                                        <div class="invalid-feedback">Please provide a valid State</div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mt-3">
                                    <div class="form-row">
                                        <label for="pinco">Pin Code</label>
                                        <input type="text" class="form-control" id="pincode"
                                               name="pincode"
                                               required style="background-color: 43596c;color: white;"
                                               placeholder="PIN code">
                                        <div class="invalid-feedback">Please provide a valid Pin Code</div>
                                    </div>
                                </div>
                                <div class="col-md-6 mt-3">
                                    <div class="form-row">
                                        <label for="country">Country</label>
                                        <input type="text" class="form-control" id="country"
                                               name="country"
                                               required style="background-color: 43596c;color: white;"
                                               placeholder="Country">
                                        <div class="invalid-feedback">Please provide a valid Country</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mt-5">
                            <div class="row">
                                <div class="col-md-12 d-flex">
                                    <h5>Shipping Address</h5>
                                    <input class="ml-4 ml-5" type="checkbox" onclick="poppins()" id="okay"
                                           name="okay">
                                    <label class="ml-2 mt-1 ml-2" for="okay">Same As Billing Address</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12 mt-3">
                                    <div class="form-row">
                                        <label for="shipstreet">Street</label>
                                        <textarea class="form-control" id="shipstreet"
                                                  name="shipstreet"
                                                  required
                                                  style="background-color: 43596c;color: white;"></textarea>
                                        <div class="invalid-feedback">Please provide a valid Street</div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mt-3">
                                    <div class="form-row">
                                        <label for="shipcity">City</label>
                                        <input type="text" class="form-control" id="shipcity"
                                               name="shipcity"
                                               required
                                               style="background-color: 43596c;color: white;" placeholder="City">
                                        <div class="invalid-feedback">Please provide a valid City</div>
                                    </div>
                                </div>
                                <div class="col-md-6 mt-3">
                                    <div class="form-row">
                                        <label for="shipstate">State</label>
                                        <select type="text" class="form-control" id="shipstate" name="shipstate"
                                                style="background-color: 43596c; color: white;">
                                            <option id="shipst" selected hidden>Choose</option>
                                            <option value="Andaman and Nicobar Islads">Andaman and Nicobar Islads
                                            </option>
                                            <option value="Andhra Predhesh">Andhra Predhesh</option>
                                            <option value="Arunachal Predesh">Arunachal Predesh</option>
                                            <option value="Assam">Assam</option>
                                            <option value="Bihar">Bihar</option>
                                            <option value="Chandigarh">Chandigarh</option>
                                            <option value="Chhattisgarh">Chhattisgarh</option>
                                            <option value="Dadra and Nagar Haveli">Dadra and Nagar Haveli</option>
                                            <option value="Damn anad Diu">Damn anad Diu</option>
                                            <option value="Delhi">Delhi</option>
                                            <option value="Goa">Goa</option>
                                            <option value="Gujarat">Gujarat</option>
                                            <option value="Haryana">Haryana</option>
                                            <option value="Himachal Predesh">Himachal Predesh</option>
                                            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                            <option value="Jharkhand">Jharkhand</option>
                                            <option value="Karnataka">Karnataka</option>
                                            <option value="Kerala">Kerala</option>
                                            <option value="Ladakh">Ladakh</option>
                                            <option value="Lakshadweep">Lakshadweep</option>
                                            <option value="Madhya Predesh">Madhya Predesh</option>
                                            <option value="Maharashtra">Maharashtra</option>
                                            <option value="Manipur">Manipur</option>
                                            <option value="Meghalaya">Meghalaya</option>
                                            <option value="Mizoram">Mizoram</option>
                                            <option value="Nagaland">Nagaland</option>
                                            <option value="Odisha">Odisha</option>
                                            <option value="Puducherry">Puducherry</option>
                                            <option value="Punjab">Punjab</option>
                                            <option value="Rajasthan">Rajasthan</option>
                                            <option value="Sikkim">Sikkim</option>
                                            <option value="Tamil Nadu">Tamil Nadu</option>
                                            <option value="Telangana">Telangana</option>
                                            <option value="Tripura">Tripura</option>
                                            <option value="Uttar Predesh">Uttar Predesh</option>
                                            <option value="Uttarakhand">Uttarakhand</option>
                                            <option value="West Bengal">West Bengal</option>
                                            <option value="Other Territory">Other Territory</option>
                                        </select>
                                        <div class="invalid-feedback">Please provide a valid State</div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mt-3">
                                    <div class="form-row">
                                        <label for="shippinco">Pin Code</label>
                                        <input type="text" class="form-control" id="shippincode"
                                               name="shippincode"
                                               required style="background-color: 43596c;color: white;"
                                               placeholder="PIN code">
                                        <div class="invalid-feedback">Please provide a valid Pin Code</div>
                                    </div>
                                </div>
                                <div class="col-md-6 mt-3">
                                    <div class="form-row">
                                        <label for="shipcountry">Country</label>
                                        <input type="text" class="form-control" id="shipcountry"
                                               name="shipcountry"
                                               required style="background-color: 43596c;color: white;"
                                               placeholder="Country">
                                        <div class="invalid-feedback">Please provide a valid Country</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="invalidCheck" required
                                       style="background-color: 43596c;">
                                <label>Agree to terms and conditions</label>
                                <div class="invalid-feedback">You must agree before submitting.</div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4"></div>
                        <div class="col-md-4">
                            <button class="btn btn-outline-info rounded-pill text-grey w-100 mt-3 mb-3"
                                    type="submit" id="customerSave">
                                Submit form
                            </button>
                        </div>
                        <div class="col-md-4"></div>
                    </div>
  
                </form>
  
  
              
            </div>
            
          </div>
        </div>
  
  
        
      </div>
    
    
      <div class="modal fade" id="newitem">
        <div class="modal-dialog modal-xl">
            <div class="modal-content" style="background-color: #213b52;">
                <div class="modal-header">
                    <h3 class="m-3">New Item</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="card p-3 m-3">
                        <form method="post" class="needs-validation" novalidate autocomplete="off" id="modalItem">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="row">
                                        <div class="col-md-12 mx-0">
                                            <div class="row">
                                                <div class="col-md-6 mt-3">
                                                    <label for="item_name" style="color: white;">Name</label>
                                                    <input type="text" name="name" class="form-control" id="item_name"
                                                        style="background-color: #2a4964; color: white;" autocomplete="off" required>
                                                </div>
                                                <div class="col-md-6 mt-3">
                                                    <label for="type" style="color: white;">Type</label>
                                                    <select name="type" class="form-control"  id="type"
                                                        style="background-color: #2a4964; color: white;" required>
                                                        <option selected disabled value="" hidden>Choose...</option>
                                                        <option value="goods">Goods</option>
                                                        <option value="services">Services</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="row">
                                                        <div class="col-md-12 mx-0">
                                                            <div class="row">
                                                                <div class="col-md-6 mt-3">
                                                                    <label for="unit" style="color: white;">Unit </label>
                                                                    <div class="d-flex">
                                                                        <select class="custom-select" name="unit" id="unit" required
                                                                            style="background-color: #2a4964; color: white;">
                                                                            <option selected disabled value="" hidden>Choose...</option>
                                                                            {% for a in unit %}
                                                                                <option style="text-transform:Uppercase;">{{ a.unit_symbol}}-{{ a.name }}</option>
                                                                            {% endfor %}
                                                                            <option>BAG-BAGS</option>
                                                                            <option>BAL-BALE</option>
                                                                            <option>BDL-BUNDLES</option>
                                                                            <option>BKL-BUCKLES</option>
                                                                            <option>BOX-BOX</option>
                                                                            <option>BOU-BILLIONS OF UNITS</option>
                                                                            <option>BTL-BOTTLES</option>
                                                                            <option>BUN-BUNCHES</option>
                                                                            <option>CAN-CANS</option>
                                                                            <option>CBM-CUBIC METER</option>
                                                                            <option>CMS-CENTIMETER</option>
                                                                            <option>CCM-CUBIC CENTIMETER</option>
                                                                            <option>CTN-CARTONS</option>
                                                                            <option>DOZ-DOZEN</option>
                                                                            <option>DRM-DRUM</option>
                                                                            <option>GGR-GREAT GROSS</option>
                                                                            <option>GMS-GRAMS</option>
                                                                            <option>GRS-GROSS</option>
                                                                            <option>GYD-GROSS YARDS</option>
                                                                            <option>KGS-KILOGRAMS</option>
                                                                            <option>KLR-KILOLITER</option>
                                                                            <option>KME-KILOMETRE</option>
                                                                            <option>MTS Metric ton</option>
                                                                            <option>MLT-MILLILITRE</option>
                                                                            <option>MTR-METERS</option>
                                                                            <option>NOS-NUMBER</option>
                                                                            <option>PAC-PACKS</option>
                                                                            <option>PCS-PIECES</option>
                                                                            <option>PRS-PAIRS</option>
                                                                            <option>QTL-QUINTAL</option>
                                                                            <option>ROL-ROLLS</option>
                                                                            <option>SQF-SQUARE FEET</option>
                                                                            <option>SET-SETS</option>
                                                                            <option>SQM-SQUARE METERS</option>
                                                                            <option>SQY-SQUARE YARDS</option>
                                                                            <option>TBS-TABLETS</option>
                                                                            <option>TGM-TEN GROSS</option>
                                                                            <option>THD-THOUSANDS</option>
                                                                            <option>TON-TONNES</option>
                                                                            <option>TUB-TUBES</option>
                                                                            <option>UGS-US GALLONS</option>
                                                                            <option>UNT-UNITS</option>
                                                                            <option>YDS-YARDS</option>
                                                                        </select>
                                                                        <!-- <button type="button" class="btn btn-outline-secondary ml-1" 
                                                                        data-target="#newunit" data-toggle="modal">+</button> -->
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-6 mt-3">
                                                                    <label for="hsn" style="color: white;">HSN Code</label>
                                                                    <input type="text" name="hsn" class="form-control" id="hsn"
                                                                     style="background-color: #2a4964; color: white;"
                                                                     placeholder="Enter a valid HSN code" required>
                                                                </div>
                                                            </div>
                                                        <div class="row">
                                                            <div class="col-md-3 mt-3">
                                                                <label for="validationCustom05" name style="color: white;">Tax Reference</label>
                                                            </div>
                                                            <div class="col-md-3 mt-3">
                                                                <div class="form-check">
                                                                    <input class="form-check-input" name="taxref" type="checkbox" id="inclusive" value="taxable" >
                                                                    <label style="color: white;">Taxable</label>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3 mt-3">
                                                                <div class="form-check" >
                                                                    <input class="form-check-input" name="taxref" type="checkbox" value="non taxable" id="check">
                                                                    <label style="color: white;">Non Taxable</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                            <div class="row" id="taxdiv" style="display: none;">
                                                                <div class="d-flex">
                                                                    <div class="col-md-6 mt-3">
                                                                        <label for="validationCustom01"
                                                                            style="color: white;">Intra State Tax Rate</label>
                                                                        <select name="intra_st" class="form-control" 
                                                                            style="background-color: #2a4964; color: white;"
                                                                            id="intra_st" >
                                                                            <option value=" " hidden>Choose...</option>
                                                                            <option value=0>GST 0 (0%)</option>
                                                                            <option value=5>GST 5 (5%)</option>
                                                                            <option value=12>GST 12 (12%)</option>
                                                                            <option value=18>GST 18 (18%)</option>
                                                                            <option value=28>GST 28 (28%)</option>
                                                                            <option value=0>Out of Scope(0%)</option>
                                                                        </select>
                                                                    </div>
                                                                    <div class="col-md-6 mt-3">
                                                                        <label for="inter_st"
                                                                            style="color: white;">Inter State Tax Rate</label>
                                                                        <select name="inter_st" class="form-control" 
                                                                                style="background-color: #2a4964; color: white;"
                                                                                id="inter_st" >
                                                                                <option value= ' ' hidden>Choose...</option>
                                                                                <option value=0>IGST 0 (0%)</option>
                                                                            <option value=5>IGST 5 (5%)</option>
                                                                            <option value=12>IGST 12 (12%)</option>
                                                                            <option value=18>IGST 18 (18%)</option>
                                                                            <option value=28>IGST 28 (28%)</option>
                                                                            <option value=0>Out of Scope(0%)</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 mt-3">
                                                        <label for="validationCustom01" style="color: white;">Purchase Price</label>
                                                        <div class="row">
                                                            <div>
                                                                <input type="text" class="form-control" value="INR"
                                                                style="margin-left:20px;width:60px;background-color: #2a4960; color: white;">
                                                            </div>
                                                            <div>
                                                                <input type="number" name="pcost" class="form-control" 
                                                                    id="purprice" style="width:540px;background-color: #2a4964; color: white; width:200%" value="0" >
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 mt-3">
                                                        <label for="validationCustom01"
                                                                style="color: white;">Sales Price</label>
                                                        <div class="row">
                                                            <div>
                                                                <input type="text" class="form-control" value="INR"
                                                                style="margin-left:20px;width:60px;background-color: #2a4960; color: white;">
                                                            </div>
                                                            <div >
                                                                <div >
                                                                    <input type="text" name="salesprice" class="form-control"
                                                                        id="saleprice" style="width:540px;background-color: #2a4964; color: white; width:200%" value="0">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-12 mx-0">
                                                        <div class="row">
                                                            <div class="col-md-6 mt-3">
                                                                <label for="validationCustom01" style="color: white;">Account</label>
                                                                <select name="pur_account" class="form-control" 
                                                                    style="background-color: #2a4964; color: white;" id="pur_account" >
                                                                    <option >Cost of Goods Sold</option>
                                                                    {% for a in acc %}
                                                                        <option value="goods">{{ a.name }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                            <div class="col-md-6 mt-3">
                                                                <label for="validationCustom01" style="color: white;">Account</label>
                                                                <select name="sale_account" class="form-control" 
                                                                style="background-color: #2a4964; color: white;" id="sale_account" >
                                                                    <option >Sales</option>
                                                                    {% for a in acc1 %}
                                                                        <option value="goods">{{ a.name }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-12 mx-0">
                                                                <div class="row">
                                                                    <div class="col-md-6 mt-3">
                                                                        <label for="validationCustom01" style="color: white;">Description</label>
                                                                        <textarea class="form-control" name="pur_desc"id="pur_desc" 
                                                                        style="background-color: #2a4964; color: white;"></textarea>  
                                                                    </div>
                                                                    <div class="col-md-6 mt-3">
                                                                        <label for="validationCustom01" style="color: white;">Description</label>
                                                                        <textarea class="form-control" name="sale_desc" id="sale_desc"
                                                                        style="background-color: #2a4964; color: white;"></textarea>
                                                                    </div>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-md-12 mx-0">
                                                                        <br>
                                                                        <div class="row" >
                                                                            <div class="col-md-3">
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" onclick="ShowHideDiv(this)" type="checkbox"  id="track">
                                                                                    <label class="form-check-label" for="track" >
                                                                                        Track Inventory
                                                                                    </label>
                                                                                </div>
                                                                            </div>
                                                                    
                                                                        </div>
                                                                        <div class="row" id="inventorytrack" style="display: none">
                                                                            <div class="col-md-6 mt-3">
                                                                                <label for="validationCustom01" style="color: white;">Inventory Account</label>
                                                                                <select name="invacc" class="form-control" id="invacc"
                                                                                    style="background-color: #2a4964; color: white;">
                                                                                    <option selected disabled value="" hidden>Choose...</option>
                                                                                    <option value="Inventory Assets">Inventory Assets</option>
                                                                                </select>
                                                                            </div>
                                                                            <div class="col-md-3 mt-3">
                                                                                <label for="validationCustom01" style="color: white;">Stock on hand</label>
                                                                                <input type="number" name="stock" class="form-control" id="stock" 
                                                                                style="background-color: #2a4964; color: white;" value="0">
                                                                            </div>
                                                                            <div class="col-md-3 mt-3">
                                                                                <label for="validationCustom01" style="color: white;">Stock Rate per Unit</label>
                                                                                <input type="number" name="stock_rate" class="form-control" id="stock_rate" 
                                                                                style="background-color: #2a4964; color: white;" value="0">
                                                                            </div>
                                                                        </div>
                                                                        
                                                                        <div class="row">
                                                                            <div class="col-md-3 mt-3">
                                                                                <label for="validationCustom05" name style="color: white;">Active/Inactive
                                                                                    </label>
                                                                            
                                                                            </div>
                                                                            <div class="col-md-3 mt-3">
                                                                                <div class="form-check">
                                                                                    <input class="form-check-input" value="Active" type="radio" name="status" id="flexRadioDefault1" checked>
                                                                                    <label class="form-check-label" for="flexRadioDefault1">
                                                                                        Active
                                                                                    </label>
                                                                                    </div>
                                                                                
                                                                            </div>
                                                                            <div class="form-check mt-3">
                                                                                <input class="form-check-input" value="Inactive" type="radio" name="status" id="flexRadioDefault2" >
                                                                                <label class="form-check-label" for="flexRadioDefault2">
                                                                                    Inactive
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="row mt-5 mb-5">
                                                                    <div class="col-md-4"></div>
                                                                    <div class="col-md-4">
                                                                        <button class="btn btn-outline-info rounded-pill w-100 text-light" data-dismiss="modal" type="submit" id="itemSave">SUBMIT</button>
                                                                    </div>
                                                                    <div class="col-md-4"></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div> 
    </div> 
    
    







      
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>


<script type="text/javascript">
    $(document).on('change','#ord_no', function() {
        ord = '{{estimate.estimateno}}'
        ord_value = $('#ord_no').val();
        if(ord_value != ord){
            document.getElementById('dangerdiv').style.display = 'block';
        }else{
            document.getElementById('dangerdiv').style.display = 'none';
        }
        var sale_list = "{{ sale_list}}";
        salelist = sale_list.split(",");
        for(let i=0; i<salelist.length; i++){
            if (ord_value == salelist[i]){
                alert('Esitmate Number already in use.')
                document.getElementById('dangerdiv').style.display = 'none';
                document.getElementById('ord_no').value = ''
            }
        }
    })
</script>


<script>
    $(document).ready(function () {
        $('#customer').selectize({
            sortField: 'value',
            
            render: {
                item: function (item, escape) {
                    if (item.value === '') {
                        return '';
                    }
                    return '<div>' + escape(item.text) + '</div>';
                }
            }
        });
    });

    // $(document).ready(function () {
    //     $('.product').selectize({
    //         sortField: 'value',
            
              
            
    //         render: {
    //             item: function (item, escape) {
    //                 if (item.value === '') {
    //                     return '';
    //                 }
    //                 return '<div>' + escape(item.text) + '</div>';
    //             }
    //         }
    //     });
    // });
 </script>

<script>
    $('#tab_logic tbody tr').each(function () {

        var html = $(this).html();
        if (html != '') {
            var qty = $(this).find('.qty').val();

            var price = $(this).find('.price').val();

            var dis = $(this).find('.disc').val();
            var bc = $("#plosu").val();
            var compstate = $("#cmpstate").val();
            if(bc==compstate){
                tax = $(this).find('.intra_tax').val();
            }
            else{
                tax = $(this).find('.inter_tax').val();
            }
            $(this).find('.taxamount').val(((qty * price)-dis) * (tax / 100));
        }
    });
</script>

<script>
    $(document).on('change','#estimatedate', function() {
        var days = parseInt($('#pay_term').val());
        order_date =new Date( document.getElementById("estimatedate").value)
        if (!isNaN(order_date.getTime())) {
            // Calculate the new date by adding 20 days
            const endDate = new Date(order_date);
            endDate.setDate(endDate.getDate() + days);
            // Format the new date as YYYY-MM-DD
            const formattedDate = endDate.toISOString().split("T")[0];
            // Set the result in the second input
            document.getElementById("expirationdate").value = formattedDate;
        } else {
                alert("Please enter a valid date.");
        }
    })
</script>

<script>
         
    // Select the form and the container for the terms rows
  const form = document.getElementById('terms-form');
  const termsContainer = document.getElementById('terms-container');
  
  // Select the button that adds new rows
  const addTermRowBtn = document.querySelector('.add-term-row');
  
  // Add event listener to the button
  addTermRowBtn.addEventListener('click', () => {
    // Create a new row div
    const newRow = document.createElement('div');
    newRow.classList.add('form-row');
    newRow.id = "newtermrow";
  
    // Create the first input field for the new row
    const termsInput = document.createElement('div');
    termsInput.classList.add('col-6');
    const termsField = document.createElement('input');
    termsField.type = 'text';
    termsField.name = 'terms';
    termsField.placeholder = 'Terms';
    termsField.classList.add('form-control');
    termsField.classList.add('text-white');
    termsField.style.backgroundColor = "#191c24";
    termsInput.appendChild(termsField);
    newRow.appendChild(termsInput);
  
    // Create the second input field for the new row
    const daysInput = document.createElement('div');
    daysInput.classList.add('col-5');
    const daysField = document.createElement('input');
    daysField.type = 'text';
    daysField.name = 'days';
    daysField.placeholder = 'No of Days';
    daysField.classList.add('form-control');
    daysField.classList.add('text-white');
    daysField.style.backgroundColor = "#191c24";
    daysInput.appendChild(daysField);
    newRow.appendChild(daysInput);
  
    // Create the delete button for the new row
    const deleteBtn = document.createElement('div');
    deleteBtn.classList.add('col-1');
    const deleteBtnEl = document.createElement('button');
    deleteBtnEl.type = 'button';
    deleteBtnEl.classList.add('btn', 'btn-outline-secondary', 'delete-term-row', 'mt-1');
    deleteBtnEl.innerText = '-';
    deleteBtnEl.style.height = '4vh';
    deleteBtn.appendChild(deleteBtnEl);
    newRow.appendChild(deleteBtn);
  
    // Append the new row to the container
    termsContainer.appendChild(newRow);
  });
  
  // Add event listener to the form to delete rows
  termsContainer.addEventListener('click', (event) => {
    // If the target element is a delete button
    if (event.target.classList.contains('delete-term-row')) {
      // Find the row to delete
      const row = event.target.closest('.form-row');
      // Remove the row
      row.remove();
    }
  });
  
  
  </script>

<script>
    $(document).on("click", "#payment", function() {
  var array1 = [];
  var array2 = [];
  array1.length = 0;
  array2.length = 0;
  $("input:text[name=terms]").each(function() {
    array1.push($(this).val());
    
  });

  $("input:text[name=days]").each(function() {
    array2.push($(this).val());
  });
 

  $.ajax({
    url: "{% url 'payment_term_for_sales' %}",
    type: 'POST',
    headers: { 'X-CSRFToken': '{{ csrf_token }}' },
    data: {
      terms: JSON.stringify(array1),
      days: JSON.stringify(array2)
    },
    success: function(response) {
      
      
      $('#newpayment').hide();
      $(".modal-backdrop").remove();
      data = response.pay_term;
      const pay = document.getElementById("pay_term");
      const termsField = document.createElement('option');
      termsField.innerHTML = data;
      pay.appendChild(termsField);

    document.getElementById("modalForm").reset();
    reloadterms()
      
  // Iterate through the data and create options
    },
  });
});

function reloadterms(){
  $.ajax({
    url: "{% url 'terms_dropdowns' %}",
    type: "GET",
    success: function(response) {
      term_data = response.term_data
      day_data = response.day_data
      
      var term_container = document.getElementById('terms-container');
      var dropdow = document.getElementById('termdrop');
      term_container.removeChild(dropdow);
      
      new_row = `<div class="form-row" id="termdrop"></div>`
      $('#terms-container').append(new_row)

      new_row = `      
        <div class="col-6" >
        <input type="text" value="Due On Receipt" class="form-control" style="background-color: #191c24; color: white;" readonly>
        </div>

        <div class="col-6">
        <input type="text" value="0" class="form-control" style="background-color: #191c24; color: white;" readonly>
        </div>       

        <div class="col-6" >
        <input type="text" value="NET 30" class="form-control" style="background-color: #191c24; color: white;" readonly>
        </div>
        <div class="col-6">
        <input type="text" value="30" class="form-control" style="background-color: #191c24; color: white;" readonly>
        </div>                                
        
        <div class="col-6" >
        <input type="text" value="NET 60" class="form-control" style="background-color: #191c24; color: white;" readonly>
        </div>
        <div class="col-6">
        <input type="text" value="60" class="form-control" style="background-color: #191c24; color: white;" readonly>
        </div>`
        $('#termdrop').append(new_row)
      
      for(let i=0; i<term_data.length;i++){
        
        new_row = `      
        <div class="col-6">
          <input type="text" value="${term_data[i]}" class="form-control" style="background-color: #191c24; color: white;" readonly>
          </div>
          <div class="col-6">
            <input type="text" value="${day_data[i]}" class="form-control" style="background-color: #191c24; color: white;" readonly>
            </div>`
            $('#termdrop').append(new_row)
          }
          
          new_row = `      
          <div class="col-6">
            <input type="text"  class="form-control" style="background-color: #191c24; color: white;" placeholder="Terms" name="terms">
            </div>
            <div class="col-6">
              <input type="text" class="form-control" style="background-color: #191c24; color: white;" placeholder="No of Days" name="days">
              </div>`
          $('#termdrop').append(new_row)

          let select = document.getElementById("pay_term");

          while (select.options.length > 0) {
          select.remove(0);
          }

          var dropdow = $('#pay_term');
          dropdow.append($('<option value="" selected hidden>Select Payment Term</option>'));
          dropdow.append($('<option value="0">Due On Receipt</option>'));
          dropdow.append($('<option value="30">NET 30</option>'));
          dropdow.append($('<option value="60">NET 60</option>'));
          
          for(let i=0; i<term_data.length;i++){
                      // Create a new option element
          let newOption = document.createElement("option");
          newOption.text = term_data[i];
          newOption.value = day_data[i]; // Set a value for the new option

          // Append the new option to the select field
          select.appendChild(newOption);
          }
    },
    error: function(xhr, status, error) {
    console.error(xhr.responseText);
    }
  });
}

</script>
<script>
    $(document).on('change', '#pay_term', function () {
        var days = parseInt($('#pay_term').val());
        order_date =new Date( document.getElementById("estimatedate").value)
        if (!isNaN(order_date.getTime())) {
            // Calculate the new date by adding 20 days
            const endDate = new Date(order_date);
            endDate.setDate(endDate.getDate() + days);
            // Format the new date as YYYY-MM-DD
            const formattedDate = endDate.toISOString().split("T")[0];
            // Set the result in the second input
            document.getElementById("expirationdate").value = formattedDate;
        } else {
                alert("Please enter a valid date.");
        }
    });
  </script>
<script>
    function changeprd(id){
     id_val = id.charAt(id.length - 1)
     document.getElementById(`qty${id_val}`).value = 0 
     document.getElementById(`tax1${id_val}`).value =  ' '
     document.getElementById(`tax2${id_val}`).value = ' '
     document.getElementById(`disc${id_val}`).value = 0
     document.getElementById(`total${id_val}`).value = 0
     document.getElementById(`taxamount${id_val}`).value = 0
     calc()
    }
 </script>
 
 <script>
     function changeqty(id){
         id_val = id.charAt(id.length - 1)
         qty = document.getElementById(id).value
         avl = document.getElementById(`qtyspan${id_val}`).innerText
         if( parseFloat(qty) > parseFloat(avl) ){
             alert("Quantity Greater than Available Quantity")
             document.getElementById(id).value = 0
             document.getElementById(`tax1${id_val}`).value = 0
             document.getElementById(`tax2${id_val}`).value = 0
             document.getElementById(`disc${id_val}`).value = 0
             document.getElementById(`taxamount${id_val}`).value = 0
             document.getElementById(`total${id_val}`).value = 0
             calc()
         }else{
             calc()
         }
     }
 </script>
 
 
 <script>
 $(document).ready(function() {
     $("#advance").change(function() {
         tot_val = parseFloat($('#grandtotal').val())
         adv_val = parseFloat($('#advance').val())
         if (tot_val<adv_val){
             $('#advance').val(0)
             $('#balance').val(tot_val.toFixed(2));
             alert("Advance Greater than Total Amount")
 
         }else{
             tot_val = tot_val - adv_val
             $('#balance').val(tot_val.toFixed(2));
         }
     })
 })
 </script>

<script>
    $(document).ready(function () {
    $('#customer').on('change', function() {
        // console.log($('#customer').val());
        // console.log($('#customer').text());
        $.ajax({
            type : 'POST',
            
            url: "{% url 'cust_details' %}",
            data: {
                id: $('#customer').val(),
                csrfmiddlewaretoken: '{{ csrf_token }}',
            },
            
            success: function(data){
                // console.log(data.email);
                document.getElementById('cust_email').value = data.email;
                document.getElementById('plosu').value = data.shipstate;
                document.getElementById('gsttype').value = data.gst_treat;
                document.getElementById('bname').value = data.street + '\n' + data.city + '\n' + data.state + '\n' + data.country  + '\n' + data.pincode ;
                if(data.gstno){
                    document.getElementById('gstnodiv').style.display = 'block';
                    document.getElementById('gstno').value = data.gstno;
                }else{
                    document.getElementById('gstnodiv').style.display = 'none';
                    document.getElementById('gstno').value = '';
                }
            }
        });
    });
});
</script>

<script>
    $(document).ready(function() {
              $("#gsttype").change(function() {
              var x=$('#gsttype').val();
              if(x=="unregistered Business") 
              {
                  $(".gstrow").removeClass('d-block');
                  $(".gstrow").addClass('d-none');
  
              }
              else if(x == 'Overseas'){
                  $(".gstrow").removeClass('d-block');
                  $(".gstrow").addClass('d-none');
              }
              else if(x == 'Consumer'){
                  $(".gstrow").removeClass('d-block');
                  $(".gstrow").addClass('d-none');
              }
              else 
              {
                  $(".gstrow").removeClass('d-none');
                  $(".gstrow").addClass('d-block');
              }
              
              });
          });
  
          $(document).ready(function () {
  
              var bc = document.getElementById("plosu").value;
              var compstate = document.getElementById("cmpstate").value;
              if (bc == compstate ) {
                  document.getElementById('cgst1').style.display = 'flex';
                  document.getElementById('sgst1').style.display = 'flex';
                  document.getElementById('igst1').style.display = 'none'; 
                  $(".intra_tax").removeClass("d-none");
                  $(".intra_tax").addClass("d-flex");
  
                  $(".inter_tax").removeClass("d-flex");
                  $(".inter_tax").addClass("d-none");
  
              } else {
                  document.getElementById('cgst1').style.display = 'none';
                  document.getElementById('sgst1').style.display = 'none';
                  document.getElementById('igst1').style.display = 'flex';
  
                  $(".inter_tax").removeClass("d-none");
                  $(".inter_tax").addClass("d-flex");
  
                  $(".intra_tax").removeClass("d-flex");
                  $(".intra_tax").addClass("d-none");
              }
  
              
          });
  
  
      
          $('#date').val(new Date().toJSON().slice(0,10));
  
          
      
          // Example starter JavaScript for disabling form submissions if there are invalid fields
          (function () {
              'use strict';
              window.addEventListener('load', function () {
                  // Fetch all the forms we want to apply custom Bootstrap validation styles to
                  var forms = document.getElementsByClassName('needs-validation');
                  // Loop over them and prevent submission
                  var validation = Array.prototype.filter.call(forms, function (form) {
                      form.addEventListener('submit', function (event) {
                          if (form.checkValidity() === false) {
                              event.preventDefault();
                              event.stopPropagation();
                          }
                          form.classList.add('was-validated');
                      }, false);
                  });
              }, false);
          })();
       
          // Example starter JavaScript for disabling form submissions if there are invalid fields
          (function () {
              'use strict';
              window.addEventListener('load', function () {
                  // Fetch all the forms we want to apply custom Bootstrap validation styles to
                  var forms = document.getElementsByClassName('needs-validation');
                  // Loop over them and prevent submission
                  var validation = Array.prototype.filter.call(forms, function (form) {
                      form.addEventListener('submit', function (event) {
                          if (form.checkValidity() === false) {
                              event.preventDefault();
                              event.stopPropagation();
                          }
                          form.classList.add('was-validated');
                      }, false);
                  });
              }, false);
          })();
       
      
          function myFunction() {
              var checkBox = document.getElementById("myCheck");
              var text = document.getElementById("bill");
              if (checkBox.checked == true) {
                  text.style.display = "block";
              } else {
                  text.style.display = "none";
              }
          }
       
          function show() {
              var checkBox = document.getElementById("Check");
              var abc = document.getElementById("sad");
              var def = document.getElementById("happy");
              if (checkBox.checked == true) {
                  abc.style.display = "block";
                  def.style.display = "block";
              } else {
                  abc.style.display = "none";
                  def.style.display = "none";
              }
          }
      
          $(document).ready(function () {
             
  
              var $select1 = $('#plosu'),
              $select2 = $('#tax1'),
              $select3 = $('#tax2'),
              $select4 = $('#tax3'),
              $select5 = $('#tax4'),
              $options = $select2.find('option'),
              $options1 = $select3.find('option'),
              $options2 = $select4.find('option'),
              $options3 = $select5.find('option');
              if ($options1.value == '{{ cmp1.state }}') {
                  $options1.text = "{{ cmp1.state }}"
              }
              $select1.on('change', function() {
                  if (this.value == "{{ cmp1.state }}") {
                      $select2.html($options.filter('[text="' + this.value + '"]'));
                      $select3.html($options1.filter('[text="' + this.value + '"]'));
                      $select4.html($options2.filter('[text="' + this.value + '"]'));
                      $select5.html($options3.filter('[text="' + this.value + '"]'));
                  } 
                  else {
                      $select2.html($options.filter('[text="' + " " + '"]'));
                      $select3.html($options1.filter('[text="' + " " + '"]'));
                      $select4.html($options2.filter('[text="' + " " + '"]'));
                      $select5.html($options3.filter('[text="' + " " + '"]'));
                  }
              }).trigger('change');
          })
       
          $(document).ready(function(){
              $("#tab_logic").on('click', '.demo', function() {
                  var currentRow = $(this).closest("tr");
                  var col1=currentRow.find("td:eq(2)").text();
                  alert(col1);
              });
          });
  
          function ShowHideDiv(track) {
                var inventorytrack = document.getElementById("inventorytrack");
    
                inventorytrack.style.display = track.checked ? "flex" : "none";
    
            }
 
  $(document).ready(function(){
    
        $('#add').click(function(){
            
            var table = document.getElementById("items-table-body");
                    var roinc = table.rows.length;
                    var bc = document.getElementById("plosu").value;
                    var compstate = document.getElementById("cmpstate").value;
                    
                    roinc++;
        
            $('#items-table-body').append(
        
                    `<tr id='addr0${roinc}'>
                            <td class="nnum" style="text-align:center;">${roinc} <input type="text"  name='id[]' value= 0 hidden></td></td>
                            <td style="width: 20%;">
                            <div class="d-flex">
                            <select name='product[]' id="product${roinc}" class="form-control product" style="background-color: #43596c; color: white;" onchange="changeprd(this.id)">
                                <option value=" " selected hidden>Select Product</option>
                                
                                    {% for i in item %}
                                        {% if i.cid_id == cmp1.cid %}
                                            <option 
                                                    value="{{ i.name  }}">{{ i.name  }} </option>
                                        {% endif %}
                                    {% endfor %}
                                    </select>

                                    <a href="#">
                                        <button type="button" class="btn btn-outline-secondary ml-1" 
                                        data-target="#newitem" data-toggle="modal">+</button>
                                    </a>
                                </div>
                            </td>
                            <td><input type="text" name='hsn[]' id="hsn${roinc}" placeholder='Enter HSN Code' class="form-control" style="background-color: #43596c; color: white;" /></td>
                            <td><input type="number" name='qty[]'  placeholder='Enter Qty' id="qty${roinc}" value=0 class="form-control qty" step=0 min=0 style="background-color: #43596c;margin-top: 27px;;  color: white;" onchange="changeqty(this.id)" />
                            <div><span></span><span id="qtyspan" class='' hidden></span></div>
                            </td>
                            <td><input type="number" name='price[]' id="unit${roinc}" placeholder='Enter Unit Price' class="form-control price" step="0.00" min="0" style="background-color: #43596c; color: white;" /></td>
                            <td>
                                        <input type="text"  id="select_tax" placeholder="Tax Rate" class="form-control seltax d-flex">

                                        <select name='tax1[]' id="tax1${roinc}" class="form-control intra_tax d-none">
                                            <option selected disabled hidden> Select GST</option>
                                            <option value=28 >28.0% GST(28%)</option>
                                            <option value=18 >18.0% GST(18%)</option>
                                            <option value=12  >12.0% GST(12%)</option>
                                                <option value=5  >05.0% GST(05%)</option>
                                            <option value=3  >03.0% GST(03%)</option>
                                                <option value=0  >0.0% GST(0%)</option>
                                        </select>
                                        <select name='tax2[]' id="tax2${roinc}" class="form-control inter_tax d-none">
                                            <option selected disabled hidden > Select IGST</option>
                                            <option value=28 >28.0% IGST(28%)</option>
                                            <option value=18 >18.0% IGST(18%)</option>
                                            <option value=12  >12.0% IGST(12%)</option>
                                                <option value=5  >05.0% IGST(05%)</option>
                                            <option value=3  >03.0% IGST(03%)</option>
                                                <option value=0  >0.0% IGST(0%)</option>
                                        </select>
                                    </td>  
                                    <td>
                                        <input type="number" name='discount[]' placeholder='Enter Discount' value=0 id="disc${roinc}" class="form-control disc" step=0 min=0>
                                    </td>
                            <td><input type="number" name='total[]' id="total${roinc}" placeholder=0 class="form-control total" value=0 step="any" readonly style="background-color: #43596c; color: white;" /></td>
                            <td style="display: none;"><input type="number" step="any" name='taxamount1' id="taxamount${roinc}" class="form-control taxamount" />
                                <td>
                                        <button type="button" id="${roinc}" class="btn  font-weight-bold clone_row fa fa-clone px-2 py-1 my-1" style="background-color:rgb(88, 107, 143);"></button><br>
                                        <button type="button" id="${roinc}" class="btn btn-danger px-2 mx-1 py-1 remove_row fa fa-close"></button>
                                    </td>
                        </tr>`);

            
        });
    });

$(document).on('change','#plosu',function()   {
                $(".seltax").removeClass('d-none');
                $(".seltax").addClass('d-flex');
                $(".intra_tax").removeClass('d-flex');
                $(".intra_tax").addClass('d-none');
                $(".inter_tax").removeClass('d-flex');
                $(".inter_tax").addClass('d-none');
                var bc = document.getElementById("plosu").value;
                var compstate = document.getElementById("cmpstate").value;
                if (bc == compstate ) {
                    document.getElementById('cgst1').style.display = 'flex';
                    document.getElementById('sgst1').style.display = 'flex';
                    document.getElementById('igst1').style.display = 'none'; 

                } else {
                    document.getElementById('cgst1').style.display = 'none';
                    document.getElementById('sgst1').style.display = 'none';
                    document.getElementById('igst1').style.display = 'flex';

                }
                    
            });


  // calculation---------------------------
  
  $(document).ready(function () {
    // Initialize Selectize on page load
    $('.product').selectize({
        sortField: 'value',
        
        render: {
            item: function (item, escape) {
                if (item.value === '') {
                    return '';
                }
                return '<div>' + escape(item.text) + '</div>';
            }
        }
    });

    // Function to handle the change event for the '.product' dropdown
    $(document).on('change', '.product',function(){ 
                
                var n = $(this).attr("id").slice(7);
                $.ajax({
                url: "{% url 'itemdata3' %}",
                type : 'GET',
                data:{
                    id : $(this).val(),
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                    },
                
                success: function(response) {
                    data = response.hsn
                    data2 = response.qty
                    data3 = response.price
                    data4 = response.gst
                    data5 = response.sgst

                    console.log(data)
                    
                    document.getElementById('hsn'+n).value = data;
                    document.getElementById('qtyspan'+n).innerHTML = data2;
                    document.getElementById('unit'+n).value = data3;
                    var bc = document.getElementById("plosu").value;
                    var compstate = document.getElementById("cmpstate").value;
                    if (bc == compstate ) {
                        $(".seltax").removeClass('d-flex');
                        $(".seltax").addClass('d-none');
                        $(".inter_tax").removeClass('d-flex');
                        $(".inter_tax").addClass('d-none');
                        $(".intra_tax").removeClass('d-none');
                        $(".intra_tax").addClass('d-flex');
                        if (data4 != ' '){
                            document.getElementById('tax1'+n).value = data4;
                            document.getElementById('tax_percent'+n).value = data4;
                        }else{
                            document.getElementById('tax1'+n).value = 0;
                            document.getElementById('tax_percent'+n).value = 0;
                        }
                        
                        
                        
                    } else {
                        $(".seltax").removeClass('d-flex');
                        $(".seltax").addClass('d-none');
                        $(".intra_tax").removeClass('d-flex');
                        $(".intra_tax").addClass('d-none');
                        $(".inter_tax").removeClass('d-none');
                        $(".inter_tax").addClass('d-flex');
                        if(data5 != ' '){
                            document.getElementById('tax2'+n).value = data5;
                            document.getElementById('tax_percent'+n).value = data5;
                        }else{
                            document.getElementById('tax2'+n).value = 0;
                            document.getElementById('tax_percent'+n).value = 0;
                        }

                    }
                },
                });
                

            });
    // Click event for removing a row
    $(document).on('click', '.remove_row', function () {
        var row_id = $(this).attr("id");
        $('#addr0' + row_id + '').remove();
        calc();
    });
});
$(document).on('click','.clone_row',function(){
        var roinc = $("#items-table-body tr").length;
        var originalRow = $(this).closest('#items-table-body tr'); 
        var clonedRow = originalRow.clone();

        clonedRow.attr('id', 'addr0' +(roinc+1));

        clonedRow.find('.nnum').text(roinc+1);

        clonedRow.find('[id]').each(function() {
            var oldId = $(this).attr('id');
            var newId = oldId.replace(/\d+/, roinc+1);
            console.log(newId)
            $(this).attr('id', newId );
        });

        clonedRow.find('.product').each(function() {
            $(this).val(originalRow.find('.product').val());
        });
        clonedRow.find('.intra_tax').each(function() {
            $(this).val(originalRow.find('.intra_tax').val());
        });
        clonedRow.find('.inter_tax').each(function() {
            $(this).val(originalRow.find('.inter_tax').val());
        });
        originalRow.after(clonedRow);
        
        calc();
        
    });
    $(document).ready(function(){

            
            $('#items-table-body').on('keyup change', function () {
                calc();
            });

            $('#tax').on('keyup change', function () {
                calc_total();
            });
          });

        function calc() {
            $('#tab_logic tbody tr').each(function () {
                var html = $(this).html();
                if (html != '') {
                    var qty = $(this).find('.qty').val();
                    
                    var price = $(this).find('.price').val();

                    var dis = $(this).find('.disc').val();
                    var bc = $("#plosu").val();
                    var compstate = $("#cmpstate").val();
                    if(bc==compstate){
                        tax = $(this).find('.intra_tax').val();
                    }
                    else{
                        tax = $(this).find('.inter_tax').val();
                    }
                    $(this).find('.total').val((parseFloat(qty) *parseFloat(price))-parseFloat(dis));
                    $(this).find('.taxamount').val(((qty * price)-dis) * (tax / 100));
                    calc_total();
                }
            });
        }

        function calc_total() {
             
            total = 0;
            $('.total').each(function () {
                total += parseFloat($(this).val());
            });
            taxamount = 0;
            $('.taxamount').each(function () {
                taxamount += parseFloat($(this).val());
            });
            $('#sub_total').val(total.toFixed(2));
            $('#tax_amount').val(taxamount.toFixed(2));
            ship = parseFloat($("#ship").val());
            // console.log( ship);
            adj_val = parseFloat($('#adj').val())
            gtot = taxamount + total + ship+adj_val;
            $('#grandtotal').val(gtot.toFixed(2));
            adv_val = parseFloat($('#advance').val())
            adv_val = gtot - adv_val
            $('#balance').val(adv_val.toFixed(2));

            test()
        }

        function test(){
                     
            var bc = $("#plosu").val();
            var compstate = $("#cmpstate").val();
            d=0
            if (bc == compstate  ) {
                gst = taxamount/2
                $('#cgst').val(parseFloat(gst.toFixed(2)));
                $('#sgst').val(parseFloat(gst.toFixed(2)));
                $('#igst').val(parseFloat(d.toFixed(2)));
            }
                
            if (bc != "{{ cmp1.state }}"  ) {
                $('#igst').val(taxamount.toFixed(2));
                $('#cgst').val(d.toFixed(2));
                $('#sgst').val(d.toFixed(2));
            }

           
        }
        function showinnum(divId, element) {
            if (element.value) {
                document.getElementById(divId).innerHTML = "EDIT ESTIMATE NO" + element.value;
            } else {
                document.getElementById(divId).innerHTML = "EDIT ESTIMATE NO";
            }
        }

        $(document).on('keyup',"#ship",function(){
            var subtot = $('#sub_total').val();
            var tax = $('#tax_amount').val();
            var sh = $("#ship").val();
            var adj = $("#adj").val();
            var adv = $("#advance").val();
            $('#grandtotal').val((parseFloat(subtot)+parseFloat(tax)+parseFloat(sh)+parseFloat(adj)).toFixed(2));
            $('#balance').val((parseFloat(subtot)+parseFloat(tax)+parseFloat(sh)+parseFloat(adj)-parseFloat(adv)).toFixed(2));
        });

        $(document).on("change", "#adj", function(){
            var subtot = $('#sub_total').val();
            var tax = $('#tax_amount').val();
            var sh = $("#ship").val();
            var adj = $("#adj").val();
            var adv = $("#advance").val();
            $('#grandtotal').val((parseFloat(subtot)+parseFloat(tax)+parseFloat(sh)+parseFloat(adj)).toFixed(2));
            $('#balance').val((parseFloat(subtot)+parseFloat(tax)+parseFloat(sh)+parseFloat(adj)-parseFloat(adv)).toFixed(2));
        });
        
 
            // create customer--------------------------

        $(document).on("click", "#customerSave", function(){
            
            $.ajax({
    
                type : 'POST',
                url:"{% url 'customers21' %}",

                data:{
                  
                    title : $('#title').val(),
                    first_name : $('#firstname').val(),
                    last_name : $('#lastname').val(),
                    company_name : $("#company").val(),
                    location : $("#location").val(),
                    openbalance : $("#openbalance").val(),
                    credit_limit : $("#crd_lmt").val(),
                    email : $("#email").val(),
                    website :$("#website").val(),
                    mobile :$("#mobile").val(),
                    street : $("#street").val(),
                    city : $("#city").val(),
                    state : $("#state").val(),
                    country : $("#country").val(),
                    pincode : $("#pincode").val(),
                    shipstreet : $("#shipstreet").val(),
                    shipcity : $("#shipcity").val(),
                    shipstate : $("#shipstate").val(),
                    shipcountry : $("#shipcountry").val(),
                    shippincode : $("#shippincode").val(),
                    gsttype :$("#gsttype").val(),
                    gstin :$("#gstin").val(),
                    panno :$("#panno").val(),

                    csrfmiddlewaretoken: '{{ csrf_token }}',
                },
                
                success: function(response) {
                    console.log("success")
                    document.getElementById("modalCustomer").reset();
                    reloadCustomer();
                },
            });        
        });


        function reloadCustomer() {

            $.ajax({
                url: "{% url 'cust_dropdown' %}",
                type: "GET",
                dataType: "json",
                data: $(this).serialize(),
                csrfmiddlewaretoken: '{{ csrf_token }}',

                success: function(response) {
                    id_list = response.id_list
                    title_list = response.title_list
                    first_name = response.first_name
                    last_name = response.last_name
                    var dropdown = $('#customer');
                    dropdown.empty();
                    dropdown.append(`<option value='NIL' selected hidden>Select Customer</option>`);

                    let select = document.getElementById("customer");
                    for(let i=0; i<id_list.length;i++){
                        // Create a new option element    
                        let newOption = document.createElement("option");
                        newOption.text = title_list[i] + ' ' + first_name[i] + ' ' + last_name[i];
                        newOption.value = id_list[i] + ' ' + first_name[i] + ' ' + last_name[i]; // Set a value for the new option

                        // Append the new option to the select field
                        select.appendChild(newOption);
                    }
                },
                error: function(xhr, status, error) {
                console.error(xhr.responseText);
                }
            });
        }

        // item modal

        var checkbox1 = document.getElementById('inclusive');
        checkbox1.addEventListener('click', function () {
            if (checkbox1.checked) {
                document.getElementById('taxdiv').style.display = 'block';
                document.getElementById('check').checked = false;
            } else {
                document.getElementById('taxdiv').style.display = 'none';
                document.getElementById('intra_st').value = ' ';
                document.getElementById('inter_st').value = ' ';
            }
        });

        var checkbox = document.getElementById('check');
        checkbox.addEventListener('click', function () {
            if (checkbox.checked) {
                document.getElementById('taxdiv').style.display = 'none';
                document.getElementById('inclusive').checked = false;
                document.getElementById('intra_st').value = ' ';
                document.getElementById('inter_st').value = ' ';
            } 

        });

        $(document).on("click","#itemSave",function(){
            var taxref,status1;
 
            if ($('#inclusive').checked) {
                tax= $('#inclusive').val();
             } 
             else if($('#check').val()){
                tax = $('#check').val();
             }
             else 
            {
             console.log("Checkbox is not checked.");
            }

            console.log(tax);
            if ($('input[name="status"]:checked').val() == 'Active'){

                status1 = $('#flexRadioDefault1').val();
            }
            else{
                status1 = $('#flexRadioDefault2').val();
            }

            $.ajax({
                
                type : 'POST',
                url:"{% url 'credit_item' %}",
                
                data:{
                    type : $("#type").val(),
                    name : $("#item_name").val(),
                    unit : $("#unit").val(),
                    hsn : $("#hsn").val(),
                    taxref : tax,
                    sell_price : $("#saleprice").val(),
                    cost_price : $("#purprice").val(),
                    sell_acc : $("#sale_account").val(),
                    cost_acc : $("#pur_account").val(),
                    sell_desc : $("#sale_desc").val(),
                    cost_desc : $("#pur_desc").val(),
                    intra_st : $("#intra_st").val(),
                    inter_st : $("#inter_st").val(),
                    invacc : $("#invacc").val(),
                    stock : $("#stock").val(),
                    status : status1,
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    
                },
                
                success: function(response) {
                    console.log(response)
                    document.getElementById("modalItem").reset();
                    reloadItem();
                },
            });        
        });


        function reloadItem() {
            $.ajax({
                url: "{% url 'item_dropdown' %}",
                type: "GET",
                dataType: "json",
                data: $(this).serialize(),
                csrfmiddlewaretoken: '{{ csrf_token }}',

                success: function(data) {
                    var dropdown = $('.product');
                    dropdown.empty();
                    dropdown.append(`<option selected hidden>Select Item</option>`);
                    $.each(data, function(key, value) {
                    
                        dropdown.append($('<option></option>').attr('value', key).text(value).val(value));
                    });

                },
                error: function(xhr, status, error) {
                console.error(xhr.responseText);
                }
            });
        }


            $(document).on("click",".seltax",function(){
                
                $(".seltax").removeClass('d-flex');
                $(".seltax").addClass('d-none');

                console.log($("#plosu").val());
                console.log($("#cmpstate").val());

                if($("#plosu").val() == $("#cmpstate").val()){
                    console.log("yes");
                    $(".inter_tax").removeClass('d-flex');
                    $(".inter_tax").addClass('d-none');

                    $(".intra_tax").removeClass('d-none');
                    $(".intra_tax").addClass('d-flex');
                    
                }
                else{
                    console.log("no");
                    $(".intra_tax").removeClass('d-flex');
                    $(".intra_tax").addClass('d-none');

                    $(".inter_tax").removeClass('d-none');
                    $(".inter_tax").addClass('d-flex');
                }

            });

            $(document).on('change','#plosu',function()   {
                $(".seltax").removeClass('d-none');
                $(".seltax").addClass('d-flex');
                $(".intra_tax").removeClass('d-flex');
                $(".intra_tax").addClass('d-none');
                $(".inter_tax").removeClass('d-flex');
                $(".inter_tax").addClass('d-none');
                var bc = document.getElementById("plosu").value;
                var compstate = document.getElementById("cmpstate").value;
                if (bc == compstate ) {
                    document.getElementById('cgst1').style.display = 'flex';
                    document.getElementById('sgst1').style.display = 'flex';
                    document.getElementById('igst1').style.display = 'none'; 

                } else {
                    document.getElementById('cgst1').style.display = 'none';
                    document.getElementById('sgst1').style.display = 'none';
                    document.getElementById('igst1').style.display = 'flex';

                }
                    
            });
                
            
    
 

 
        function poppins() {
            var chkbtn = document.getElementById('okay');
            if (chkbtn.checked == true) {
                document.getElementById('shipstreet').value = document.getElementById('street').value;
                document.getElementById('shipcity').value = document.getElementById('city').value;
                document.getElementById('shippincode').value = document.getElementById('pincode').value;
                document.getElementById('shipcountry').value = document.getElementById('country').value;
                document.getElementById('shipstate').value = document.getElementById('state').value;
                document.getElementById('shipst').innerHTML = document.getElementById('state').value;
            } else {
                document.getElementById('shipstreet').value = '';
                document.getElementById('shipcity').value = '';
                document.getElementById('shipstate').value = '';
                document.getElementById('shippincode').value = '';
                document.getElementById('shipcountry').value = '';
            }
        }
   
        function hidinput(divId, element) {
            if (element.value == 'unregistered Business'  || element.value == 'Consumer' || element.value == 'Overseas') {
                document.getElementById(divId).style.display = 'none';
            } else {
                document.getElementById(divId).style.display = 'block';
                document.getElementById("gstin").value = '';
            }
        }

        function showMessage(input) {
            const gstin = input.value;

            if (gstin.length === 15) {
                // document.getElementById("message").textContent = "Please wait, validating GSTIN format...";
                setTimeout(() => checkgst(input), 1000);  // Wait for a second and then validate GSTIN
            } else {
                document.getElementById("message").textContent = "";
            }
        }

        function checkgst(element) {
            var gstinput = element.value;
            var gstregexp = "[0-9]{2}[a-zA-Z]{5}[0-9]{4}[a-zA-Z]{1}[1-9A-Za-z]{1}[Z]{1}[0-9a-zA-Z]{1}";
            if (gstinput.match(gstregexp)) {
                document.getElementById('warngst').innerHTML = '';
            } else {
                document.getElementById('warngst').innerHTML = 'Please provide a valid GSTIN';
                alert('Please provide a valid GSTIN');
            }
        }

        function checkpan(element) {
            var paninput = element.value;
            var panregexp = ["[a-zA-Z]{5}[0-9]{4}[a-zA-Z]{1}"]
            if (paninput.match(panregexp)) {
                document.getElementById('warnpan').innerHTML = '';
            } else {
                document.getElementById('warnpan').innerHTML = 'Please provide a valid PAN Number';
                alert('Please provide a valid PAN Number')
            }
        }

        function checkweb(element) {
            var webinput = element.value;
            var webregexp = "www."
            if (webinput.startsWith(webregexp)) {
                document.getElementById('warnweb').innerHTML = '';
            } else {
                document.getElementById('warnweb').innerHTML = 'Please provide a valid Website Address';
                alert('Please provide a valid Website Address')
            }
        }

        function checkphone(element) {
            var phoneinput = element.value;
            var phoneregexp = "[0-9]{10}";
            if (phoneinput.match(phoneregexp)) {
                document.getElementById('warnphone').innerHTML = '';
            } else {
                document.getElementById('warnphone').innerHTML = 'Please provide a valid Phone Number';
                alert('Please provide a valid Phone Number')
            }
        }

  
</script>


<script>
    $(document).on('change', '#openbalance',function () {
        openbal = $("#openbalance").val()
        if($('#bal').val()=='credit'){
            if(openbal.slice(0,1) != '-'){
                if(parseFloat(openbal) != 0){
                    document.getElementById("openbalance").value = "-"+openbal
                }else{
                    document.getElementById("openbalance").value = openbal
                }
            }else{
                if(parseFloat(openbal) != 0){
                    document.getElementById("openbalance").value = openbal
                }else{
                    document.getElementById("openbalance").value = -1 * parseFloat(openbal)
                }
            }
        }else{
            document.getElementById("openbalance").value = openbal
        }
    });

    $(document).on('change', '#bal',function () {
        openbal = $("#openbalance").val()
        if(openbal != ""){
            if($('#bal').val()=='credit'){
                openbal = $("#openbalance").val()
                if (parseFloat(openbal) != 0){
                    document.getElementById("openbalance").value = "-"+openbal
                }else{
                    document.getElementById("openbalance").value = openbal
                }
            }else{
                openbal = $("#openbalance").val()
                document.getElementById("openbalance").value = -1*(parseFloat(openbal))
            }
        }
    });
</script>

{% endblock %}
